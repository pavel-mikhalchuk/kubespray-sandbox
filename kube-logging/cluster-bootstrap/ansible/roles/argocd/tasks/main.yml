- name: Create Argocd Namespace
  command: kubectl create namespace argocd
  ignore_errors: true

- name: Deploy Argo CD
  command: kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/v1.1.2/manifests/install.yaml

- name: Install Argo CD CLI
  get_url:
    url: https://github.com/argoproj/argo-cd/releases/download/v1.1.2/argocd-linux-amd64
    dest: /usr/bin/argocd
    mode: '0755'

- name: Get password for Argo CD Login
  shell: kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2
  register: argocd_password

- name: Print password
  debug:
    msg: "Password - {{ argocd_password }}"