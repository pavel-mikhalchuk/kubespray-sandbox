- name: Check Kube Config
  stat:
    path: ~/.kube/config
  register: kube_config

- fail:
    msg: "Kube config is not found at '~/.kube/config'"
  when: kube_config.stat.exists == False

- name: Get Helm Tiller Status
  k8s_facts:
    kind: Deployment
    label_selectors:
      - app = helm
      - name = tiller
    namespace: kube-system
  register: tiller

- name: Install Helm Tiller
  import_tasks: helm-tiller.yml
  vars:
    tiller_state: present
  when: tiller.resources | length == 0
